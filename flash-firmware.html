---
layout: default
title: ESP32 Web Flasher
---

<div class="content">
  <h1>ESP32 Web Flasher</h1>
  <p>Click the button below to flash your ESP32 device.</p>
  <button id="select-port">Select Port</button>
  <button id="flash-firmware" disabled>Flash Firmware</button>
  <p id="status">Status: Waiting for user interaction...</p>
  <div id="log"></div>
</div>

<script type="module">
  import { ESPLoader } from 'https://cdn.jsdelivr.net/gh/espressif/esptool-js@latest/dist/web/esploader.js';

  const statusElement = document.getElementById('status');
  let port;
  let loader;

  const logMessage = (message) => {
    const logElement = document.getElementById('log');
    const p = document.createElement('p');
    p.textContent = message;
    logElement.appendChild(p);
  };

  document.getElementById('select-port').addEventListener('click', async () => {
    console.log('Select Port button clicked'); // Debug log
    statusElement.textContent = 'Requesting port selection...'; // Status update
    try {
      port = await navigator.serial.requestPort(); // Open the port selection dialog
      console.log('Port selected:', port);
      statusElement.textContent = 'Port selected. Ready to connect.';
      logMessage('Port successfully selected.');
      document.getElementById('flash-firmware').disabled = false; // Enable the next button
    } catch (error) {
      console.error('Error selecting port:', error);
      statusElement.textContent = `Error selecting port: ${error.message}`;
      logMessage(`Error: ${error.message}`);
    }
  });
</script>
